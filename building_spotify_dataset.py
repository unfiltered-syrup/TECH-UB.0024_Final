# -*- coding: utf-8 -*-
"""Building Spotify Dataset.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1uXvR0Vx2P8ItDG5woSw62A6lb0UFywQR
"""

pip install spotipy

import spotipy
import pandas as pd

import requests
cid = "213bd88d2dc74e808f362031c8ecb51d"
cs= "b09c834ecb4b47638048cbbc08ed4f8d"

from spotipy.oauth2 import SpotifyClientCredentials
import spotipy
from pprint import pprint

sp = spotipy.Spotify(client_credentials_manager=SpotifyClientCredentials(cid,cs))

pl_id = 'spotify:playlist:37i9dQZF1DWY1j3jZdCWOQ'
offset = 0

while True:
    response = sp.playlist_items(pl_id,
                                 offset=offset,
                                 fields='items.track.id,total',
                                 additional_types=['track'])
    
    if len(response['items']) == 0:
        break
    
    #pprint(response['items'])
    offset = offset + len(response['items'])
    #print(offset, "/", response['total'])
    track_ids=[]

    for a in response["items"]:
      track_ids.append(a["track"]["id"])

#USED SPOTIFY API , GOT DOCUMENTATION ONLINE 


AUTH_URL = 'https://accounts.spotify.com/api/token'

# UPLOADS ME CREDENTIALS
auth_response = requests.post(AUTH_URL, {
    'grant_type': 'client_credentials',
    'client_id': "213bd88d2dc74e808f362031c8ecb51d",
    'client_secret': "b09c834ecb4b47638048cbbc08ed4f8d",
})

auth_response_data = auth_response.json()

#GIVES ME MY ACCESS TOKEN
access_token = auth_response_data['access_token']
access_token

headers = {
    'Authorization': 'Bearer {token}'.format(token=access_token)
}
# base URL of all Spotify API endpoints
BASE_URL = 'https://api.spotify.com/v1/'

# Lists for the data frame 
Danceability=[]
Energy=[]
Loudness=[]
Tempo=[]
Valence=[]

for id in track_ids:
# actual GET request with proper header
  r = requests.get(BASE_URL + 'audio-features/' + id, headers=headers)
  r=r.json()
  Danceability.append(r["danceability"])
  Energy.append(r["energy"])
  Loudness.append(r["loudness"])
  Tempo.append(r["tempo"])
  Valence.append(r["valence"])

track_names=[]
for id in track_ids:
  track_names.append(sp.track(id)["name"])

music_df = pd.DataFrame({'Track': track_names, 'Danceability': Danceability, 'Energy': Energy, 'Loudness': Loudness, 'Tempo': Tempo, 'Valence':Valence})
print(music_df)